--- 
layout: post
title: Machine Learning Ex2 - Linear Regression
categories: 
- r
- machinelearning
- statistics
---







<p>
Andrew Ng has posted introductory machine learning lessons on the <a href="http://openclassroom.stanford.edu/MainFolder/CoursePage.php?course=MachineLearning">OpenClassRoom</a> site. I've watched the first set and will here solve <a href="http://openclassroom.stanford.edu/MainFolder/DocumentPage.php?course=MachineLearning&amp;doc=exercises/ex2/ex2.html">Exercise 2</a>.
</p>
<p>
The exercise is to build a linear regression implementation, I'll use R.
</p>


<script src="http://www.mathjax.org/mathjax/MathJax.js" type="text/javascript">
    MathJax.Hub.Config({
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "left",
        displayIndent: "2em",
 
        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
</script>


<p>
The point of linear regression is to come up with a mathematical function(model) that represents the data as best as possible, that is done by fitting a straight line to the observed data. This model will then allow us to make predictions on new data.
</p>
<p>
For example, the data we use here are boys ages and their corresponding heights, so when we get the mathematical model we will be able to guess the boys height from his age.
</p>

<div class="outline-2" id="outline-container-1">
<h2 id="sec-1">Data </h2>
<div class="outline-text-2" id="text-1">





<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">load the data
</span>mydata = read.csv(<span style="color: #8b2252;">"http://spreadsheets.google.com/pub?key=0AnypY27pPCJydDB4N3MxM0tENlk3UElnZ013cW1iM3c&amp;hl=en_GB&amp;single=true&amp;gid=0&amp;output=csv"</span>, header = <span style="color: #228b22;">TRUE</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">include ggplot2
</span><span style="color: #008b8b;">library</span>(ggplot2)

ex2plot = ggplot(mydata, aes(x, y)) + geom_point() + 
       ylab(<span style="color: #8b2252;">'Height in meters'</span>) +
       xlab(<span style="color: #8b2252;">'Age in years'</span>)
</pre>




<p>
<img src="http://al3xandr3.github.com/img/ml-ex2-data.png" alt="http://al3xandr3.github.com/img/ml-ex2-data.png" />
</p>
</div>

</div>

<div class="outline-2" id="outline-container-2">
<h2 id="sec-2">Theory </h2>
<div class="outline-text-2" id="text-2">


<p>
The model we will get at the end is a line that fits the data, is defined like so:
</p>
<p>
Assuming \(x_0 = 1\):
</p>


\[
h_\theta(x) = \theta_0 x_0 + \theta_1 x_1 + \theta_2 x_2 + ...
\]

<p>
That can be summarized by (last is matrix notation):
</p>


\[
h_\theta(x) = \sum_{i=0}^n \theta_i x_i = \theta^T x
\]

<p>
Matrix representation is useful because has good support in software tools.
</p>
<p>
Goal is to get the line closest to observed data points as possible, thus we can define a cost function that returns the difference of the real data vs myModel:
</p>


\[
J(\theta) = \frac{1}{2m} \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2
\]

<p>
where \(i\) is each data example we have and \(m\) is their total.
</p>
<p>
With J we now have a metric to check if the hypotheses line is getting closer to data points or not.
</p>
<p>
Next step is to find the smaller cost as possible from J, and in fact thats exactly what the <a href="http://mathworld.wolfram.com/MethodofSteepestDescent.html">gradient descent algorithm does</a>: starting with an inicial guess it iterates to smaller and smaller values of a given function by following the <a href="http://www.wolframalpha.com/input/?i=Plot[{x^2,+2+x},+{x,+0,+2.2}]">direction of the derivative</a>:
</p>


\[
x_i := x_{i-1} - \epsilon f^' (x_{i-1})
\]

<p>
Applying to our J:
</p>


\[
\theta_j := \theta_j - \alpha \frac{\delta}{\delta \theta_j} J(\theta)
\]

<p>
And doing a bit of calculus on derivatives we get:
</p>


\[
\theta_j := \theta_j - \alpha \frac{1}{m} \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)}) x^{(i)}
\]

<p>
Where \(\alpha\) defines the size of steps of the convergence to \(\theta\).
</p>
<p>
Now lets check if all this math really works.
</p>
</div>

</div>

<div class="outline-2" id="outline-container-3">
<h2 id="sec-3">Implementation - take 1 </h2>
<div class="outline-text-2" id="text-3">





<pre class="src src-R">alpha = 0.07
m = length(mydata$x)
theta = c(0,0)
x = mydata$x
y = mydata$y 
delta = <span style="color: #7f007f;">function</span>(x,y,th,m) {
  sum = 0
  <span style="color: #7f007f;">for</span> (i <span style="color: #7f007f;">in</span> 1:m) {
    sum = sum + (((t(th) %*% c(1,x[i])) - y[i]) * c(1,x[i]))
  }
  <span style="color: #7f007f;">return</span> (sum)
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">1 iteration
</span>theta - alpha * 1/m * delta(x,y,theta,m)
</pre>



<pre class="example">
[1] 0.07452802 0.38002167
</pre>


</div>

</div>

<div class="outline-2" id="outline-container-4">
<h2 id="sec-4">Implementation - take 2 </h2>
<div class="outline-text-2" id="text-4">


<p>
After having a peek at the <a href="http://openclassroom.stanford.edu/MainFolder/courses/MachineLearning/exercises/ex2materials/ex2.m">Matlab solution</a>, i learned that is possible to replace the sum in the equation with a transpose matrix multiplication(like done with the line equation):
</p>


\[
\theta := \theta - \alpha \frac{1}{m} x^T (x\theta^T - y)
\]

<p>
So we can get a full matrix implementation:
</p>



<pre class="src src-R">alpha = 0.07
m = length(mydata$x)
theta = matrix(c(0,0), nrow=1)
x = matrix(c(rep(1,m), mydata$x), ncol=2)
y = matrix(mydata$y, ncol=1)
delta = <span style="color: #7f007f;">function</span>(x,y,th) {
  delta = (t(x) %*% ((x %*% t(th)) - y))
  <span style="color: #7f007f;">return</span>(t(delta))
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">1 iteration
</span>theta - alpha * 1/m * delta(x,y,theta)
</pre>



<pre class="example">
           [,1]      [,2]
[1,] 0.07452802 0.3800217
</pre>


</div>

</div>

<div class="outline-2" id="outline-container-5">
<h2 id="sec-5">The Model </h2>
<div class="outline-text-2" id="text-5">


<p>
First we run several iterations, until convergence:
</p>



<pre class="src src-R"><span style="color: #7f007f;">for</span> (i <span style="color: #7f007f;">in</span> 1:1500) {
  theta = theta - alpha * 1/m * delta(x,y,theta)
}
theta
</pre>



<pre class="example">
          [,1]       [,2]
[1,] 0.7501504 0.06388338
</pre>


<p>
And finally we see how well the line(model) fits the data:
</p>



<pre class="src src-R">ex2plot + geom_abline(intercept=theta[1], slope=theta[2])
</pre>




<p>
<img src="http://al3xandr3.github.com/img/ml-ex2-fit.png" alt="http://al3xandr3.github.com/img/ml-ex2-fit.png" />
</p>


</div>

<div class="outline-4" id="outline-container-5_1">
<h4 id="sec-5_1">References </h4>
<div class="outline-text-4" id="text-5_1">

<ul>
<li><a href="http://www.math.umaine.edu/~hiebeler/comp/matlabR.html">MATLAB / R Reference, by David Hiebeler</a>
</li>
<li><a href="ftp://ftp.ams.org/pub/tex/doc/amsmath/short-math-guide.pdf">Short Math Guide for LaTex(.pdf)</a>
</li>
<li><a href="http://wims.unice.fr/wims/en_tool~linear~matmult.en.html">Matrix multiplier tool</a>
</li>
<li>Thanks to Andrew Ng and <a href="http://openclassroom.stanford.edu/MainFolder/HomePage.php">OpenClassRoom</a> for the great lessons. 
</li>
</ul>

</div>
</div>
</div>


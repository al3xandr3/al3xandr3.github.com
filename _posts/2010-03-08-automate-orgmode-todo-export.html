--- 
layout: post
title: Automating todo tasks reports with org-mode
categories: 
- org-mode
- emacs
- automations
- ruby
---







<p>
Here's the geek automation of the week, its for helping creating reports from my TODO tasks list when using the amazing emacs org-mode(<a href="http://orgmode.org/">see here whats orgmode all about</a>).
</p>

<div class="outline-2" id="outline-container-1">
<h2 id="sec-1">(simplified) Work Flow </h2>
<div class="outline-text-2" id="text-1">


<ol>
<li>I get a request, add it into my todo list queue, marking it as a TODO item.
</li>
<li>Work, work, work, guided by the todo listed tasks, balancing priority and effort and (..add your own reason here..).
</li>
<li>When finished, mark an item DONE.
</li>
<li>Generate a report every week with the done tasks.
</li>
</ol>

</div>

</div>

<div class="outline-2" id="outline-container-2">
<h2 id="sec-2">Generating the Report </h2>
<div class="outline-text-2" id="text-2">


<p>
(I use this setup on Mac, with some adaptations should also on Linux and Windows)
</p>
<p>
Every week i then generate a report of the DONE Tasks, by running:
</p>



<pre class="example"># file: get-work-done.sh 
# run: sh get-work-done.sh

# Uses emacs to extract the DONE items from work.org, generating a work-done.csv
/Applications/Aquamacs.app/Contents/MacOS/Aquamacs -batch -l ~/.emacs -eval '(org-batch-agenda-csv "+TODO=\"DONE\"" org-agenda-files (quote ("/.../work.org")))' &gt; work-done.csv

# Applies desired report formatting to the exported work-done.csv, generating work.csv
ruby format-report.rb work-done.csv

# Clean up the originally exported file
rm work-done.csv

# Opens the final file in the default .csv handler, typically Excel.
open work.csv
</pre>



<p>
See the comments "#" to understand what it does in each step.
</p>
<p>
Then I use the format-report.rb that apply's the final formatting to the report, for example: add my own header, add/remove columns, Dates, change names, calculate values, etc, etc&hellip; see example:
</p>



<pre class="src src-ruby"><span style="color: #b22222;"># </span><span style="color: #b22222;">file: format-report.rb
</span>
flines = <span style="color: #228b22;">File</span>.open(<span style="color: #228b22;">ARGV</span>[0]).readlines

column_map = { 
  <span style="color: #8b2252;">"from_name1"</span>  =&gt; <span style="color: #8b2252;">"to_name1"</span>, 
  <span style="color: #8b2252;">"from_name2"</span>  =&gt; <span style="color: #8b2252;">"to_name2"</span>,  
}

<span style="color: #228b22;">File</span>.open( <span style="color: #8b2252;">"work.csv"</span>,<span style="color: #8b2252;">"w+"</span>) <span style="color: #7f007f;">do</span> |fl|  
  fl.puts <span style="color: #8b2252;">"header1,header2,header3,header4"</span>
  flines.each <span style="color: #7f007f;">do</span> |l|
    a = l.split(<span style="color: #8b2252;">","</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">Time, mapping-defined-in-column_map, original-column-2
</span>    fl.puts <span style="color: #228b22;">Time</span>.now.strftime(<span style="color: #8b2252;">"%m/%d/%Y"</span>) + <span style="color: #8b2252;">","</span> + 
            (column_map[a[1]] || a[1]) + <span style="color: #8b2252;">","</span> + a[2] <span style="color: #8b2252;">","</span> + a[3]
  <span style="color: #7f007f;">end</span>
<span style="color: #7f007f;">end</span>
</pre>



<p>
And voila, i run this and an excel(my default .csv app) sheet opens up with the report of the week.
</p></div>
</div>
<div id="postamble">

</div>
